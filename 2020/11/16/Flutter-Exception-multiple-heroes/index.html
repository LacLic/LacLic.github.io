<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="LacLic Vanilla"><link rel="alternative" href="/atom.xml" title="LacLic's Blog" type="application/atom+xml"><link rel="icon" href="/img/avatar.png"><title>Flutter_Exception_multiple_heroes - LacLic's Blog</title>
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]-->
<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/fancybox/jquery.fancybox.min.js"></script>
<meta name="generator" content="Hexo 5.2.0"></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">LacLic's Blog</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/tags">标签</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-11-16T14:31:23.000Z">2020 - 11 - 16 22:31:23</time><h1 class="post__title"><a href="/2020/11/16/Flutter-Exception-multiple-heroes/">Flutter_Exception_multiple_heroes</a></h1><div class="post__main echo"><h1 id="Flutter-Exception：-emsp-There-are-multiple-heroes-that-share-the-same-tag-within-a-subtree"><a href="#Flutter-Exception：-emsp-There-are-multiple-heroes-that-share-the-same-tag-within-a-subtree" class="headerlink" title="Flutter Exception： &emsp;There are multiple heroes that share the same tag within a subtree"></a>Flutter Exception： <br>&emsp;<em>There are multiple heroes that share the same tag within a subtree</em></h1><p>Created by: © LacLic</p>
<h2 id="错误发生"><a href="#错误发生" class="headerlink" title="错误发生"></a>错误发生</h2><p>&emsp;这个异常(exception)主要出现于一个页面/路由(route)中有<strong>两个及以上</strong>的浮标按钮(FloatingActionButtom)。</p>
<p>&emsp;以下是异常报错代码及状况：<br>*<del>仅展示了部分代码</del>*</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// ...省略无关代码</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: <span class="comment">/* ...省略无关代码 */</span>,</span><br><span class="line">    body: Center(</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          <span class="comment">/*...省略无关widget代码 */</span></span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            onPressed: () =&gt; Navigator.pushNamed(context, <span class="string">&quot;test_form&quot;</span>),</span><br><span class="line">            child: Icon(Icons.plus_one),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    floatingActionButton: FloatingActionButton(</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        Navigator.pushNamed(context, <span class="string">&quot;test_theme&quot;</span>);</span><br><span class="line">        _decrementCounter();</span><br><span class="line">      &#125;,</span><br><span class="line">      tooltip: <span class="string">&#x27;new page&#x27;</span>,</span><br><span class="line">      child: Icon(Icons.home),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</br>

<p><img src="https://i.loli.net/2020/11/16/2NzUaxAYipJShn4.gif" alt="example.gif" title="example"></p>
<p>&emsp;会出现如图所示的异常(exception)</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>&emsp;只需要向各个浮标按钮的heroTag参数传入一个与其它浮标按钮不同的值（字符串）即可：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FloatingActionButton(</span><br><span class="line">  onPressed: () =&gt; Navigator.pushNamed(context, <span class="string">&quot;test_form&quot;</span>),</span><br><span class="line">  child: Icon(Icons.plus_one),</span><br><span class="line">  heroTag: <span class="string">&#x27;example&#x27;</span>, <span class="comment">// &lt;- here</span></span><br><span class="line">),</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>里面的example可以替换成任意你想输入的值，只要不与其它的浮标按钮(FloatingActionButtom)的heroTag值相同即可  </p>
<h2 id="错误原理"><a href="#错误原理" class="headerlink" title="错误原理"></a>错误原理</h2><p>&emsp;<em>首先得知道Hero是Flutter中的一种动画形式，两个带有同样hero标识的元素在页面切换时会有一个飞动的效果，该效果由flutter自动实现。该标识对应的属性名为heroTag，在同一个页面内，每个heroTag只能拥有一个独一无二的值（和 html 中的 id 一样），如果重复就会抛出标题所示的异常 ‘There are multiple heroes that share the same tag within a subtree.’</em> [^REF]</p>
<p>&emsp;Flutter 相应部分源码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> FloatingActionButton(&#123;</span><br><span class="line">  <span class="comment">//省略无关参数</span></span><br><span class="line">  <span class="keyword">this</span>.heroTag = <span class="keyword">const</span> _DefaultHeroTag(),</span><br><span class="line">  <span class="comment">//省略无关参数</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_DefaultHeroTag</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _DefaultHeroTag();</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() =&gt; <span class="string">&#x27;&lt;default FloatingActionButton tag&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&emsp;明显看出，heroTag会被默认初始化为 ‘&lt;default FloatingActionButton tag&gt;‘ ，导致未向heroTag传入参数的地方，全都默认为上面那段字符串</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="built_in">Object</span> heroTag;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">The callback that is called when the button is tapped or otherwise activated.</span></span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="markdown">If this is set to null, the button will be disabled.</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&emsp;就是说这个参数是用来管理这个按钮的点击等事件的，如果多个按钮使用同一个heroTag则会触发联动，造成问题，为了防止问题，flutter提前进行了异常报错</p>
<p>[^REF]: <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37828249/article/details/105185954">CSDN id: in_motion 的博客</a>.</p>
</div></header></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat.png" title="微信"><img src="/img/alipay.png" title="支付宝"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2020 LacLic Vanilla</div></footer>
<script src="/js/scroller.js"></script>

<script src="/js/main.js"></script>
</body></html>